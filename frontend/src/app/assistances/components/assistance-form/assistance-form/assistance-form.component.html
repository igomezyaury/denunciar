<h1 class="text-center title mt-5">Nuevo registro</h1>
<div *ngIf="showSuccessMessage" class="alert alert-success mt-3" role="alert">
    El registro ha sido creado correctamente
</div>
<div class="text-danger text-center" *ngIf="errorMessage">
    {{ errorMessage }}
</div>
<form [formGroup]="assistanceForm">
    <app-stepper formArrayName="steps" #cdkStepper>
        <cdk-step formGroupName="0" [stepControl]="formArray.get([0])">
            <!-- Step label -->
            <ng-template cdkStepLabel>
                <strong>Desarrollo</strong>
            </ng-template>
            <!-- Step content -->
            <div class="col-md-8 mx-auto mt-5">
                <div class="form-group">
                    <div class="form-row col-md-6 mx-auto">
                        <div class="form-check form-check-inline col-md-3">
                            <input formControlName="assistance_type" type="checkbox" class="form-check-input">
                            <label class="form-check-label">Asesoramiento</label>
                        </div>
                        <div class="form-check form-check-inline col-md-4">
                            <input formControlName="femicide_risk" type="checkbox" class="form-check-input">
                            <label class="form-check-label">Riesgo de vida</label>
                        </div>
                        <div class="form-check form-check-inline col-md-4">
                            <input formControlName="first_call" type="checkbox" class="form-check-input">
                            <label class="form-check-label">Primera llamada</label>
                        </div>
                    </div>
                </div>
                <div class="dropdown-divider col-md-6 mx-auto mt-3 mb-3"></div>
                <div class="form-row col-md-6 mx-auto">
                    <div class="form-group col-md-6">
                        <label for="date_time">Fecha y hora</label>
                        <input type="date" class="form-control" formControlName="date_time"
                            [ngClass]="{ 'is-invalid': submitted && !isValid('0','date_time') }">
                        <div class="invalid-feedback">
                            Fecha válida requerida
                        </div>
                    </div>
                    <div class="form-group col-md-6">
                        <label for="">Teléfono entrante</label>
                        <input type="text" class="form-control" formControlName="phone_number"
                            [ngClass]="{ 'is-invalid': submitted && !isValid('0','phone_number') }">
                        <div class="invalid-feedback">
                            Número de teléfono válido requerido
                        </div>
                    </div>
                </div>
                <div class="dropdown-divider col-md-6 mx-auto mt-3 mb-3"></div>
                <div class="form-row col-md-6 mx-auto">
                    <div class="form-group col-md-12">
                        <label for="">Desarrollo</label>
                        <textarea class="form-control" rows="6" formControlName="summary"
                            [ngClass]="{ 'is-invalid': submitted && !isValid('0','summary') }"></textarea>
                        <div class="invalid-feedback">
                            Desarrollo requerido
                        </div>
                    </div>
                </div>
                <button class="btn btn-secondary col-md-1 float-left" disabled>Anterior</button>
                <button class="btn btn-primary btn-purple col-md-1 float-right" cdkStepperNext>Siguiente</button>
            </div>
        </cdk-step>
        <cdk-step formGroupName="1" [stepControl]="formArray.get([1])">
            <!-- Step label -->
            <ng-template cdkStepLabel>
                <strong>Persona</strong>
            </ng-template>
            <div class="col-md-7 mx-auto mt-5">
                <div class="form-row col-md-12">
                    <div class="form-group col-md-2">
                        <label for="identification_type_id">Tipo</label>
                        <select formControlName="identification_type_id" class="form-control"
                            [ngClass]="{ 'is-invalid': submitted && !isValid('1','identification_type_id') }">
                            <option *ngFor="let idType of idTypes" [value]="idType.id">{{idType.name}}
                            </option>
                        </select>
                        <div class="invalid-feedback">
                            Tipo requerido
                        </div>
                    </div>
                    <div class="form-group col-md-2">
                        <label for="identification_code">N° de documento</label>
                        <input formControlName="identification_code" type="text" class="form-control"
                            [ngClass]="{ 'is-invalid': submitted && !isValid('1','identification_code') }">
                        <div class="invalid-feedback">
                            N° de documento válido requerido
                        </div>
                    </div>
                    <div class="form-group col-md-2">
                        <label for="first_name">Nombre</label>
                        <input formControlName="first_name" type="text" class="form-control"
                            [ngClass]="{ 'is-invalid': submitted && !isValid('1','first_name') }">
                        <div class="invalid-feedback">
                            Nombre requerido
                        </div>
                    </div>
                    <div class="form-group col-md-2">
                        <label for="last_name">Apellido</label>
                        <input formControlName="last_name" type="text" class="form-control"
                            [ngClass]="{ 'is-invalid': submitted && !isValid('1','last_name') }">
                        <div class="invalid-feedback">
                            Apellido requerido
                        </div>
                    </div>
                    <div class="form-group col-md-3">
                        <label for="birth_date">Fecha de nacimiento</label>
                        <input formControlName="birth_date" type="date" class="form-control"
                            [ngClass]="{ 'is-invalid': submitted && !isValid('1','birth_date') }">
                        <div class="invalid-feedback">
                            Fecha de nacimiento inválida
                        </div>
                    </div>
                    <div class="form-group col-md-1">
                        <label for="age">Edad</label>
                        <input formControlName="age" type="text" class="form-control"
                            [ngClass]="{ 'is-invalid': submitted && !isValid('1','age') }">
                        <div class="invalid-feedback">
                            Edad inválida
                        </div>
                    </div>
                </div>
                <div class="dropdown-divider col-md-12 mx-auto mt-3 mb-3"></div>
                <div class="form-row col-md-12">
                    <div class="form-group col-md-2">
                        <label for="city_id">Localidad</label>
                        <select formControlName="city_id" class="form-control"
                            [ngClass]="{ 'is-invalid': submitted && !isValid('1','city_id') }">
                            <option *ngFor="let city of cities" [value]="city.id">{{city.name}}
                            </option>
                        </select>
                        <div class="invalid-feedback">
                            Localidad requerida
                        </div>
                    </div>
                    <div class="form-group col-md-2">
                        <label for="address">Domicilio</label>
                        <input formControlName="address" type="text" class="form-control"
                            [ngClass]="{ 'is-invalid': submitted && !isValid('1','address') }">
                        <div class="invalid-feedback">
                            Domicilio requerido
                        </div>
                    </div>
                    <div class="form-group col-md-2">
                        <label for="phone_number">Teléfono</label>
                        <input formControlName="phone_number" type="text" class="form-control"
                            [ngClass]="{ 'is-invalid': submitted && !isValid('1','phone_number') }">
                        <div class="invalid-feedback">
                            Teléfono válido requerido
                        </div>
                    </div>
                    <div class="form-group col-md-2">
                        <label for="city_id">Discapacidad</label>
                        <select formControlName="disabilities" class="form-control">
                            <option *ngFor="let disability of disabilities" [value]="disability.id">{{disability.name}}
                            </option>
                        </select>
                    </div>
                    <div class="form-group col-md-2">
                        <label for="city_id">Sexo</label>
                        <select formControlName="disabilities" class="form-control" (change)="changeSexSelect($event)">
                            <option *ngFor="let sex of sexTypes" [value]="sex.id">{{sex.name}}
                            </option>
                        </select>
                    </div>
                    <div class="form-group col-md-2">
                        <label for="sex_clarification">Sexo Otros</label>
                        <input disabled #sexClarification formControlName="sex_clarification" type="text"
                            class="form-control">
                    </div>
                </div>
                <div class="dropdown-divider col-md-12 mx-auto mt-3 mb-3"></div>
                <div class="form-check col-md-12 mb-4">
                    <input type="checkbox" class="form-check-input" (change)="changeRepresentative($event)">
                    <label class="form-check-label">¿Representante?</label>
                </div>
                <div class="form-row col-md-12">
                    <div class="form-group col-md-3">
                        <label for="representative_type_id">Tipo</label>
                        <select disabled #representativeType formControlName="representative_type_id"
                            class="form-control"
                            [ngClass]="{ 'is-invalid': submitted && !isValid('1','representative_type_id') }">
                            <option *ngFor="let representativeType of representativeTypes"
                                [value]="representativeType.id">{{representativeType.name}}
                            </option>
                        </select>
                        <div class="invalid-feedback">
                            Requerido
                        </div>
                    </div>
                    <div class="form-group col-md-3">
                        <label for="representative_first_name">Nombre del representante</label>
                        <input disabled #representativeFirstName formControlName="representative_first_name" type="text"
                            class="form-control"
                            [ngClass]="{ 'is-invalid': submitted && !isValid('1','representative_first_name') }">
                        <div class="invalid-feedback">
                            Requerido
                        </div>
                    </div>
                    <div class="form-group col-md-3">
                        <label for="representative_last_name">Apellido del representante</label>
                        <input disabled #representativeLastName formControlName="representative_last_name" type="text"
                            class="form-control"
                            [ngClass]="{ 'is-invalid': submitted && !isValid('1','representative_last_name') }">
                        <div class="invalid-feedback">
                            Requerido
                        </div>
                    </div>
                    <div class="form-group col-md-3">
                        <label for="relationship_type_id">Vínculo</label>
                        <select disabled #relationshipType formControlName="relationship_type_id" class="form-control"
                            [ngClass]="{ 'is-invalid': submitted && !isValid('1','relationship_type_id') }">
                            <option *ngFor="let relationShipType of relationShipTypes" [value]="relationShipType.id">
                                {{relationShipType.name}}
                            </option>
                        </select>
                        <div class="invalid-feedback">
                            Requerido
                        </div>
                    </div>
                </div>
                <button class="btn btn-secondary col-md-1 float-left" cdkStepperPrevious>Anterior</button>
                <button class="btn btn-primary btn-purple col-md-1 float-right" cdkStepperNext>Siguiente</button>
            </div>
        </cdk-step>
        <cdk-step formGroupName="2" [stepControl]="formArray.get([2])">
            <ng-template cdkStepLabel>
                <strong>Agresor</strong>
            </ng-template>
            <div class="col-md-8 mx-auto mt-5">
                <div class="form-row col-md-8 mx-auto">
                    <div class="form-group col-md-6">
                        <label for="aggressor_first_name">Nombre agresor</label>
                        <input formControlName="aggressor_first_name" type="text" class="form-control"
                            [ngClass]="{ 'is-invalid': submitted && !isValid('2','aggressor_first_name') }">
                        <div class="invalid-feedback">
                            Máximo 50 caracteres
                        </div>
                    </div>
                    <div class="form-group col-md-6">
                        <label for="aggressor_last_name">Apellido agresor</label>
                        <input formControlName="aggressor_last_name" type="text" class="form-control"
                            [ngClass]="{ 'is-invalid': submitted && !isValid('2','aggressor_last_name') }">
                        <div class="invalid-feedback">
                            Máximo 50 caracteres
                        </div>
                    </div>
                </div>
                <div class="form-row col-md-8 mx-auto">
                    <div class="form-group col-md-2">
                        <label for="aggressor_identification_type_id">Tipo</label>
                        <select formControlName="aggressor_identification_type_id" class="form-control">
                            <option *ngFor="let idType of idTypes" [value]="idType.id">{{idType.name}}
                            </option>
                        </select>
                    </div>
                    <div class="form-group col-md-4">
                        <label for="aggressor_identification_code">N° de documento del agresor</label>
                        <input formControlName="aggressor_identification_code" type="text" class="form-control"
                            [ngClass]="{ 'is-invalid': submitted && !isValid('2','aggressor_identification_code') }">
                        <div class="invalid-feedback">
                            N° de documento inválido
                        </div>
                    </div>
                    <div class="form-group col-md-6">
                        <label>Dirección del agresor</label>
                        <input type="text" class="form-control">
                    </div>
                </div>
                <div class="form-row col-md-8 mx-auto">
                    <div class="form-group col-md-6">
                        <label for="aggressor_occupation">Ocupación del agresor</label>
                        <input formControlName="aggressor_occupation" type="text" class="form-control">
                    </div>
                    <div class="form-group col-md-6">
                        <label for="aggressor_city_id">Localidad del agresor</label>
                        <select formControlName="aggressor_city_id" class="form-control">
                            <option *ngFor="let city of cities" [value]="city.id">{{city.name}}
                            </option>
                        </select>
                    </div>
                </div>
                <button class="btn btn-secondary col-md-1 float-left" cdkStepperPrevious>Anterior</button>
                <button class="btn btn-primary btn-purple col-md-1 float-right" cdkStepperNext>Siguiente</button>
            </div>
        </cdk-step>
        <cdk-step formGroupName="3" [stepControl]="formArray.get([3])">
            <ng-template cdkStepLabel>
                <strong>Denuncia</strong>
            </ng-template>
            <div class="col-md-8 mx-auto mt-5">
                <div class="form-row col-md-8 mx-auto">
                    <div class="form-group col-md-6">
                        <label for="issue_address">Domicilio del hecho</label>
                        <input formControlName="issue_address" type="text" class="form-control">
                    </div>
                    <div class="form-group col-md-6">
                        <label for="vulnerable_population_id">Población vulnerable</label>
                        <select formControlName="vulnerable_population_id" class="form-control"
                            [ngClass]="{ 'is-invalid': submitted && !isValid('3','vulnerable_population_id') }">
                            <option *ngFor="let vulnerablePopulation of vulnerablePopulations"
                                [value]="vulnerablePopulation.id">{{vulnerablePopulation.name}}
                            </option>
                        </select>
                        <div class="invalid-feedback">
                            Requerido
                        </div>
                    </div>
                </div>
                <div class="form-row col-md-8 mx-auto">
                    <div class="form-group col-md-6">
                        <label for="violence_types">Tipo de violencia</label>
                        <select formControlName="violence_types" class="form-control"
                            [ngClass]="{ 'is-invalid': submitted && !isValid('3','violence_types') }">
                            <option *ngFor="let violenceType of violenceTypes" [value]="violenceType.id">
                                {{violenceType.name}}
                            </option>
                        </select>
                        <div class="invalid-feedback">
                            Requerido
                        </div>
                    </div>
                    <div class="form-group col-md-6">
                        <label for="complaint_reason_id">Motivo de la denuncia</label>
                        <select formControlName="complaint_reason_id" class="form-control"
                            [ngClass]="{ 'is-invalid': submitted && !isValid('3','complaint_reason_id') }">
                            <option *ngFor="let complaintReason of complaintReasons" [value]="complaintReason.id">
                                {{complaintReason.name}}
                            </option>
                        </select>
                        <div class="invalid-feedback">
                            Requerido
                        </div>
                    </div>
                </div>
                <div class="form-row col-md-8 mx-auto">
                    <div class="form-group col-md-6">
                        <label for="derivation_types"><b>Derivación</b></label>
                        <select formControlName="derivation_types" class="form-control"
                            [ngClass]="{ 'is-invalid': submitted && !isValid('3','derivation_types') }">
                            <option *ngFor="let derivationType of derivationTypes" [value]="derivationType.id">
                                {{derivationType.name}}
                            </option>
                        </select>
                        <div class="invalid-feedback">
                            Requerido
                        </div>
                    </div>
                    <div class="form-group col-md-6">
                        <label for="violence_types"><b>Código</b></label>
                        <select formControlName="code" class="form-control"
                            [ngClass]="{ 'is-invalid': submitted && !isValid('3','code') }">
                            <option *ngFor="let code of codes" [value]="code.id">
                                {{code.name}}
                            </option>
                        </select>
                        <div class="invalid-feedback">
                            Requerido
                        </div>
                    </div>
                </div>
                <div class="form-row col-md-8 mx-auto">
                    <div class="form-group col-md-6">
                        <label for="origin_type_id">Origen</label>
                        <select formControlName="origin_type_id" class="form-control"
                            [ngClass]="{ 'is-invalid': submitted && !isValid('3','origin_type_id') }">
                            <option *ngFor="let originType of originTypes" [value]="originType.id">
                                {{originType.name}}
                            </option>
                        </select>
                        <div class="invalid-feedback">
                            Requerido
                        </div>
                    </div>
                    <div class="form-group col-md-6">
                        <label for="">Derivación observaciones</label>
                        <textarea class="form-control" rows="4" formControlName="derivation_observation"></textarea>
                    </div>
                </div>
                <button class="btn btn-secondary col-md-1 float-left" cdkStepperPrevious>Anterior</button>
                <button class="btn btn-primary btn-purple col-md-1 float-right"
                    (click)="submitAssistance()">Guardar</button>
            </div>
        </cdk-step>
    </app-stepper>
</form>